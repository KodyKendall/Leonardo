<%= turbo_frame_tag dom_id(line_item_material_breakdown) do %>
  <div class="card bg-base-100 shadow-md mb-4">
    <!-- Header -->
    <div class="card-body pb-3">
      <div class="flex items-center justify-between">
        <div>
          <h3 class="card-title text-lg font-bold">Material Breakdown</h3>
          <span class="badge badge-primary"><%= line_item_material_breakdown.tender_line_item&.item_description || "No Line Item" %></span>
        </div>
      </div>
    </div>

    <!-- Material Rows Table Header -->
    <div class="px-6 pb-3 border-t">
      <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-7 gap-4 text-xs font-semibold text-gray-600 uppercase tracking-wide">
        <div class="col-span-1 lg:col-span-2">Material</div>
        <div>Waste</div>
        <div>Rate (R)</div>
        <div>Qty</div>
        <div class="text-right">Total</div>
        <div></div>
      </div>
    </div>

    <!-- Material Rows -->
    <div class="border-t" id="line_item_materials_container_<%= line_item_material_breakdown.id %>">
      <% if line_item_material_breakdown.line_item_materials.any? %>
        <% line_item_material_breakdown.line_item_materials.each do |material| %>
          <%= render partial: 'line_item_materials/line_item_material', locals: { line_item_material: material } %>
        <% end %>
      <% else %>
        <div class="px-6 py-4 text-center text-gray-500 text-sm" id="no_materials_message_<%= line_item_material_breakdown.id %>">
          No materials added yet.
        </div>
      <% end %>
    </div>

    <!-- Add Material Button -->
    <div class="px-6 py-3 border-t bg-gray-50">
      <%= button_to line_item_materials_path,
          method: :post,
          params: { line_item_material: { line_item_material_breakdown_id: line_item_material_breakdown.id } },
          class: "btn btn-sm btn-outline" do %>
        <i class="fa-solid fa-plus"></i> Add Material
      <% end %>
    </div>

    <!-- Totals Section -->
    <div class="px-6 py-4 bg-gray-50 border-t space-y-2">
      <div class="flex justify-between text-sm">
        <span class="font-semibold text-gray-700">SUBTOTAL:</span>
        <span class="font-semibold text-gray-900">R<%= number_with_precision(line_item_material_breakdown.subtotal, precision: 2, delimiter: ",") %></span>
      </div>

      <div class="flex justify-between text-sm">
        <span class="font-semibold text-gray-700">MARGIN %:</span>
        <div class="join">
          <input type="number" placeholder="0" step="0.1" class="input input-bordered input-xs w-20 text-right join-item" disabled />
          <span class="btn btn-xs no-animation join-item">%</span>
        </div>
      </div>

      <div class="flex justify-between text-lg font-bold border-t pt-2">
        <span class="text-gray-900">TOTAL:</span>
        <span class="text-blue-600">R<%= number_with_precision(line_item_material_breakdown.total, precision: 2, delimiter: ",") %></span>
      </div>
    </div>
  </div>
<% end %>
