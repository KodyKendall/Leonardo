<!-- Totals Section -->
<div class="px-6 py-4 bg-gray-50 border-t space-y-3" id="material_breakdown_totals_<%= line_item_material_breakdown.id %>">
  <div class="flex justify-between text-xs">
    <span class="text-gray-600">Subtotal:</span>
    <span class="font-semibold text-gray-900" data-line-item-material-breakdown-target="subtotalDisplay">R<%= number_with_precision(line_item_material_breakdown.subtotal, precision: 2, delimiter: ",") %></span>
  </div>

  <%= form_with model: line_item_material_breakdown,
               url: line_item_material_breakdown_path(line_item_material_breakdown),
               method: :patch,
               class: "flex justify-between text-xs items-center gap-2",
               data: {
                 turbo_stream: true,
                 controller: "margin-form",
                 action: "turbo:submit-end->margin-form#handleSuccess"
               } do |f| %>
    <span class="text-gray-600">Markup:</span>
    <div class="flex items-center gap-2">
      <div class="join">
        <%= f.number_field :margin_percentage,
            placeholder: "0",
            step: 0.1,
            class: "input input-bordered input-xs w-16 text-right join-item text-xs border-gray-300",
            data: {
              line_item_material_breakdown_target: "marginInput",
              margin_form_target: "input",
              action: "input->line-item-material-breakdown#markDirty input->line-item-material-breakdown#recalculate keydown->margin-form#submitOnEnter"
            } %>
        <span class="btn btn-xs no-animation join-item text-xs">%</span>
      </div>
      <button type="submit" class="btn btn-xs btn-ghost transition-all opacity-0 pointer-events-none"
        data-line-item-material-breakdown-target="saveButton"
        data-margin-form-target="submitButton"
        title="Save markup">
        <i class="fa-solid fa-check text-success text-sm"></i>
      </button>
    </div>
  <% end %>

  <div class="flex justify-between items-center border-t pt-3">
    <span class="text-sm font-semibold text-gray-700">Material Supply Total:</span>
    <span class="text-base font-semibold text-blue-600" data-line-item-material-breakdown-target="totalDisplay">R<%= number_with_precision(line_item_material_breakdown.total, precision: 2, delimiter: ",") %></span>
  </div>
</div>
