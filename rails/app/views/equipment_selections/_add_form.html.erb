<%= turbo_frame_tag "equipment_form" do %>
  <div class="bg-blue-50 border-t-2 border-blue-200 px-6 py-4">
    <h3 class="font-semibold text-sm text-blue-900 mb-4">Add New Equipment Selection</h3>
    
    <%= form_with model: [tender, new_equipment_selection],
                  url: tender_equipment_selections_path(tender),
                  local: true,
                  data: { turbo_stream: true } do |f| %>
      <div class="grid grid-cols-12 gap-3 items-end">
        <!-- Equipment Type Dropdown -->
        <div class="col-span-3">
          <label class="label label-text text-xs font-semibold">Equipment Type</label>
          <%= f.select :equipment_type_id,
                      grouped_options_for_select(
                        equipment_types.group_by(&:category).map { |cat, items|
                          [cat.humanize, items.map { |e| ["#{e.model} (#{e.working_height_m}m)" , e.id] }]
                        }
                      ),
                      { prompt: "Select equipment..." },
                      class: "select select-bordered select-sm w-full",
                      required: true %>
        </div>

        <!-- Units Input -->
        <div class="col-span-2">
          <label class="label label-text text-xs font-semibold">Units</label>
          <%= f.number_field :units_required, 
                            value: 1, 
                            min: 1, 
                            step: 1,
                            class: "input input-bordered input-sm w-full",
                            required: true %>
        </div>

        <!-- Months Input -->
        <div class="col-span-2">
          <label class="label label-text text-xs font-semibold">Months</label>
          <%= f.number_field :period_months, 
                            value: 1, 
                            min: 1, 
                            step: 1,
                            class: "input input-bordered input-sm w-full",
                            required: true %>
        </div>

        <!-- Purpose Input -->
        <div class="col-span-3">
          <label class="label label-text text-xs font-semibold">Purpose</label>
          <%= f.text_field :purpose,
                          placeholder: "e.g., Material handling",
                          class: "input input-bordered input-sm w-full" %>
        </div>

        <!-- Add Button -->
        <div class="col-span-2 flex gap-2">
          <%= f.submit "Add Equipment", class: "btn btn-primary btn-sm flex-1" %>
        </div>
      </div>

      <!-- Error Messages -->
      <% if new_equipment_selection.errors.any? %>
        <div class="mt-3 p-3 bg-red-50 border border-red-200 rounded text-sm">
          <p class="font-semibold text-red-800 mb-2">
            <%= pluralize(new_equipment_selection.errors.count, "error") %> prevented save:
          </p>
          <ul class="list-disc ml-5 text-red-700">
            <% new_equipment_selection.errors.full_messages.each do |message| %>
              <li><%= message %></li>
            <% end %>
          </ul>
        </div>
      <% end %>
    <% end %>
  </div>
<% end %>
