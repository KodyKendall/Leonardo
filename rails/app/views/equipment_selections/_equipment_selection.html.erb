<tr class="hover:bg-gray-50" 
    id="<%= dom_id(equipment_selection) %>"
    data-controller="dirty-form"
    data-action="input->dirty-form#change change->dirty-form#change turbo:submit-end->dirty-form#reset">
    <%= form_with model: [equipment_selection.tender, equipment_selection],
                  url: tender_equipment_selection_path(equipment_selection.tender, equipment_selection),
                  method: :patch,
                  local: true,
                  class: "contents",
                  data: {
                    turbo_stream: true
                  } do |f| %>
      <!-- Equipment Type (Read-only) -->
      <td class="px-6 py-4 text-sm font-medium text-gray-900">
        <div class="flex flex-col">
          <span class="font-semibold"><%= equipment_selection.equipment_type.category.humanize %></span>
          <span class="text-xs text-gray-500"><%= equipment_selection.equipment_type.model %></span>
          <% if equipment_selection.equipment_type.working_height_m.present? %>
            <span class="text-xs text-gray-500">Height: <%= equipment_selection.equipment_type.working_height_m %>m</span>
          <% end %>
        </div>
      </td>

      <!-- Units (Editable) -->
      <td class="px-6 py-4 text-sm">
        <%= f.number_field :units_required, min: 1, step: 1, class: "input input-sm input-bordered w-20" %>
      </td>

      <!-- Months (Editable) -->
      <td class="px-6 py-4 text-sm">
        <%= f.number_field :period_months, min: 1, step: 1, class: "input input-sm input-bordered w-20" %>
      </td>

      <!-- Purpose (Editable) -->
      <td class="px-6 py-4 text-sm">
        <%= f.text_field :purpose, placeholder: "e.g., Hoisting", class: "input input-sm input-bordered w-full" %>
      </td>

      <!-- Monthly Cost (Editable - Override) -->
      <td class="px-6 py-4 text-sm">
        <div class="flex flex-col gap-1">
          <div class="text-[10px] text-gray-400 font-medium uppercase tracking-wider">
            R<%= number_with_precision(equipment_selection.calculated_monthly_cost, precision: 2, delimiter: ",") %>
          </div>
          <div class="flex items-center gap-1">
            <span class="text-xs text-gray-400">R</span>
            <%= f.number_field :monthly_cost_override, step: 0.01, class: "input input-sm input-bordered w-28 text-xs", placeholder: "Override" %>
          </div>
        </div>
      </td>

      <!-- Total Cost (Calculated, Read-only) -->
      <td class="px-6 py-4 text-sm font-bold text-green-700">
        R<%= number_with_precision(equipment_selection.total_cost, precision: 2, delimiter: ",") %>
      </td>

      <!-- Actions -->
      <td class="px-6 py-4 text-sm">
        <div class="flex items-center gap-2">
          <!-- Dirty Indicator -->
          <span class="hidden text-warning text-xs font-medium" data-dirty-form-target="indicator">
            <i class="fas fa-circle-exclamation"></i>
          </span>

          <!-- Save Button -->
          <button type="submit" 
                  class="btn btn-primary btn-sm" 
                  data-dirty-form-target="submit"
                  title="Save changes">
            <i class="fas fa-check"></i>
          </button>

          <!-- Delete Button -->
          <%= link_to tender_equipment_selection_path(equipment_selection.tender, equipment_selection),
              data: { turbo_method: :delete, turbo_confirm: "Delete this equipment selection?" },
              class: "btn btn-error btn-sm",
              title: "Delete" do %>
            <i class="fas fa-trash"></i>
          <% end %>
        </div>
      </td>
    <% end %>
  </tr>
