<%# Scoped index table for tender_crane_selections inside breakdown builder %>
<%# This partial renders all tender_crane_selections for the parent breakdown %>

<div class="bg-white rounded-lg border border-gray-200 overflow-hidden">
  <% if @on_site_mobile_crane_breakdown.tender.tender_crane_selections.any? %>
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">
              Size
            </th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">
              Ownership Type
            </th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">
              Purpose
            </th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">
              Duration (days)
            </th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">
              Wet Rate/Day (R)
            </th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">
              Total Cost (R)
            </th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">
              Actions
            </th>
          </tr>
        </thead>
        <tbody id="tender_crane_selections_table" class="divide-y divide-gray-200" data-controller="tender-crane-index">
          <% @on_site_mobile_crane_breakdown.tender.tender_crane_selections.each do |tender_crane_selection| %>
            <tr id="<%= dom_id tender_crane_selection %>" class="hover:bg-gray-50 transition-colors">
              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                <%= tender_crane_selection.crane_rate&.size || "—" %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium <%= tender_crane_selection.crane_rate&.ownership_type == 'rental' ? 'bg-orange-100 text-orange-800' : 'bg-indigo-100 text-indigo-800' %>">
                  <%= tender_crane_selection.crane_rate&.ownership_type&.titleize || "—" %>
                </span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                <%= tender_crane_selection.purpose %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                <%= tender_crane_selection.duration_days %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-900">
                R <%= number_with_precision(tender_crane_selection.wet_rate_per_day, precision: 2) %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-900">
                R <%= number_with_precision(tender_crane_selection.total_cost, precision: 2) %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm flex gap-2">
                <%= link_to tender_crane_selection_path(tender_crane_selection), 
                  class: "btn btn-circle btn-outline btn-sm",
                  title: "View details",
                  data: { turbo: false } do %>
                  <i class="fas fa-eye text-lg"></i>
                <% end %>
                <%= button_to tender_crane_selection_path(tender_crane_selection), 
                  method: :delete, 
                  form_class: "contents",
                  class: "btn btn-circle btn-error btn-sm", 
                  title: "Delete",
                  data: { turbo_confirm: "Are you sure?" } do %>
                  <i class="fas fa-trash text-lg"></i>
                <% end %>
              </td>
            </tr>
          <% end %>
          
          <!-- Totals Row -->
          <tr class="bg-gray-100 font-bold">
            <td colspan="3" class="px-6 py-4 text-right text-sm text-gray-900">
              TOTALS:
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
              <%= @on_site_mobile_crane_breakdown.tender.tender_crane_selections.sum(:duration_days) %>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
              R <%= number_with_precision(@on_site_mobile_crane_breakdown.tender.tender_crane_selections.sum(:wet_rate_per_day), precision: 2) %>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
              R <%= number_with_precision(@on_site_mobile_crane_breakdown.tender.tender_crane_selections.sum(:total_cost), precision: 2) %>
            </td>
            <td></td>
          </tr>
        </tbody>
      </table>
    </div>
  <% else %>
    <div class="p-8 text-center text-gray-500">
      <i class="fas fa-inbox text-4xl mb-4 opacity-50"></i>
      <p class="font-medium">No tender crane selections found.</p>
      <p class="text-sm mt-2">Click "Add Row" below to create your first selection.</p>
    </div>
  <% end %>
  
  <!-- Add Row Button -->
  <div class="px-6 py-4 bg-gray-50 border-t border-gray-200 flex justify-end">
    <%= link_to new_tender_crane_selection_path(tender_id: @on_site_mobile_crane_breakdown.tender.id), 
      class: "btn btn-primary btn-sm gap-2",
      data: { turbo: false } do %>
      <i class="fas fa-plus"></i>
      Add Row
    <% end %>
  </div>
</div>
