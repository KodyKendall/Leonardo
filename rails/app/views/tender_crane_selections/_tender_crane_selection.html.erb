<%# Standalone show view for tender_crane_selection with inline editing %>
<turbo-frame id="<%= dom_id tender_crane_selection %>" class="w-full my-5 block" data-controller="inline-edit" data-inline-edit-target="container">

  <div class="flex gap-2 items-end">
    <%# Form for Inline Editing %>
    <%= form_with model: tender_crane_selection, local: true, class: "contents", data: { inline_edit_target: "form", turbo_stream: true }, id: "#{dom_id tender_crane_selection}_form" do |f| %>

      <%# Tender ID (read-only) - Link to Tender %>
      <div class="form-group flex-1">
        <% if tender_crane_selection.tender %>
          <%= link_to tender_crane_selection.tender.tender_name, tender_path(tender_crane_selection.tender), class: "link link-primary text-sm font-medium", data: { turbo: false } %>
        <% else %>
          <span class="text-gray-400 text-sm">â€”</span>
        <% end %>
      </div>

      <%# Crane Rate ID (Dropdown) %>
      <div class="form-group flex-1">
        <%= f.collection_select :crane_rate_id,
          CraneRate.all.order(:size, :ownership_type),
          :id,
          lambda { |rate| "#{rate.size} (#{rate.ownership_type == 'rsb_owned' ? 'RSB Owned' : 'Rental'})" },
          { prompt: "Select crane..." },
          class: "select select-bordered select-sm w-full readonly:bg-gray-100",
          readonly: true,
          data: { inline_edit_target: "field" } %>
      </div>

      <%# Purpose (Editable Dropdown) %>
      <div class="form-group flex-1">
        <%= f.select :purpose,
          [['Splicing', 'splicing'], ['Main', 'main']],
          { prompt: 'Select...' },
          class: "select select-bordered select-sm w-full readonly:bg-gray-100",
          readonly: true,
          data: { inline_edit_target: "field" } %>
      </div>

      <%# Quantity (Editable) %>
      <div class="form-group flex-1">
        <%= f.number_field :quantity,
          class: "input input-bordered input-sm w-full readonly:bg-gray-100",
          data: { inline_edit_target: "field", action: "change->inline-edit#calculateTotal" } %>
      </div>

      <%# Duration Days (Editable) %>
      <div class="form-group flex-1">
        <%= f.number_field :duration_days,
          class: "input input-bordered input-sm w-full readonly:bg-gray-100",
          data: { inline_edit_target: "field", action: "change->inline-edit#calculateTotal" } %>
      </div>

      <%# Wet Rate Per Day (Editable) %>
      <div class="form-group flex-1">
        <%= f.number_field :wet_rate_per_day,
          step: :any,
          class: "input input-bordered input-sm w-full readonly:bg-gray-100",
          readonly: true,
          data: { inline_edit_target: "field" } %>
      </div>

      <%# Total Cost (Read-only, calculated) %>
      <div class="form-group flex-1">
        <input
          type="text"
          value="R <%= number_with_precision(tender_crane_selection.total_cost, precision: 2) %>"
          readonly
          data-total-cost-display="true"
          class="input input-bordered input-sm w-full readonly:bg-gray-100" />
      </div>

      <%# Edit Button (Pencil Icon / Checkmark) %>
      <button type="button"
        data-inline-edit-target="editBtn"
        data-action="inline-edit#toggleEditMode"
        class="btn btn-circle btn-outline btn-sm"
        title="Edit">
        <i class="fas fa-pencil text-lg" data-inline-edit-target="editIcon"></i>
      </button>

      <%# Hidden Submit Button %>
      <%= f.submit "", style: "display: none;", data: { "inline-edit-target": "submit" } %>
    <% end %>

    <%# Delete Button - OUTSIDE the edit form to avoid nested forms %>
    <%= button_to tender_crane_selection_path(tender_crane_selection),
      method: :delete,
      form_class: "contents",
      class: "btn btn-circle btn-error btn-sm",
      title: "Delete",
      data: { turbo_stream: true, turbo_confirm: "Are you sure?" } do %>
      <i class="fas fa-trash text-lg"></i>
    <% end %>
  </div>

  <%# Status Indicator (Unsaved Changes) %>
  <div data-inline-edit-target="unsavedIndicator" class="hidden flex items-center gap-2 p-3 mt-4 bg-yellow-50 border border-yellow-200 rounded-md">
    <i class="fas fa-exclamation-circle text-yellow-600"></i>
    <span class="text-sm font-medium text-yellow-800">You have unsaved changes</span>
  </div>

  <%# Saved Confirmation (hidden by default) %>
  <div data-inline-edit-target="savedIndicator" class="hidden flex items-center gap-2 p-3 mt-4 bg-green-50 border green-200 rounded-md">
    <i class="fas fa-check-circle text-green-600"></i>
    <span class="text-sm font-medium text-green-800">Changes saved</span>
  </div>
</turbo-frame>
