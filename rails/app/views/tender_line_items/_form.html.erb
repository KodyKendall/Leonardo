<%= form_with(model: [@tender, @tender_line_item], local: true, class: "space-y-6") do |form| %>
  <% if @tender_line_item.errors.any? %>
    <div id="error_explanation" class="bg-red-50 border border-red-200 rounded-lg p-4">
      <h2 class="font-bold text-red-900 mb-2"><%= pluralize(@tender_line_item.errors.count, "error") %> prohibited this tender line item from being saved:</h2>
      <ul class="list-disc list-inside space-y-1 text-red-800 text-sm">
        <% @tender_line_item.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
    <div>
      <%= form.label :quantity, "Quantity", class: "block text-sm font-medium text-gray-700 mb-2" %>
      <%= form.number_field :quantity, step: 0.01, min: 0, class: "w-full rounded-md border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500", placeholder: "Enter quantity" %>
      <p class="text-xs text-gray-500 mt-1">Precision: 12 digits, 2 decimals</p>
    </div>

    <div>
      <%= form.label :rate, "Rate (₹)", class: "block text-sm font-medium text-gray-700 mb-2" %>
      <%= form.number_field :rate, step: 0.01, min: 0, class: "w-full rounded-md border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500", placeholder: "Enter rate" %>
      <p class="text-xs text-gray-500 mt-1">Precision: 12 digits, 2 decimals</p>
    </div>
  </div>

  <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
    <p class="text-sm text-blue-900">
      <strong>Total Amount:</strong> 
      <span id="total_amount" class="font-bold text-lg">₹ 0.00</span>
    </p>
  </div>

  <div class="flex gap-2">
    <%= form.submit class: "rounded-md px-3.5 py-2.5 bg-blue-600 hover:bg-blue-500 text-white font-medium cursor-pointer" %>
    <%= link_to "Cancel", tender_path(@tender), class: "rounded-md px-3.5 py-2.5 bg-gray-100 hover:bg-gray-50 inline-block font-medium" %>
  </div>
<% end %>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const quantityInput = document.querySelector('input[name*="quantity"]');
    const rateInput = document.querySelector('input[name*="rate"]');
    const totalAmountSpan = document.getElementById('total_amount');

    function updateTotalAmount() {
      const quantity = parseFloat(quantityInput.value) || 0;
      const rate = parseFloat(rateInput.value) || 0;
      const total = quantity * rate;
      
      totalAmountSpan.textContent = '₹ ' + total.toLocaleString('en-IN', {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
      });
    }

    if (quantityInput) quantityInput.addEventListener('input', updateTotalAmount);
    if (rateInput) rateInput.addEventListener('input', updateTotalAmount);

    updateTotalAmount();
  });
</script>
