<% if @line_item_material.persisted? %>
  <!-- Clear the modal content (triggers close via JS observer) -->
  <turbo-stream action="update" target="modal">
    <template></template>
  </turbo-stream>

  <!-- Update the breakdown if it exists on the page -->
  <% if @breakdown %>
    <!-- Append the new material to the container instead of replacing the whole breakdown -->
    <turbo-stream action="append" target="line_item_materials_container_<%= @breakdown.id %>">
      <template>
        <%= render partial: 'line_item_materials/show', formats: [:html], locals: { line_item_material: @line_item_material } %>
      </template>
    </turbo-stream>
  <% end %>
<% else %>
  <turbo-stream action="replace" target="modal">
    <template>
      <%= render partial: 'line_item_materials/form', formats: [:html], locals: { line_item_material: @line_item_material } %>
    </template>
  </turbo-stream>
<% end %>
