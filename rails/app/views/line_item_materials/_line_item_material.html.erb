<style>
  /* Hide number input spinners */
  input[type="number"]::-webkit-outer-spin-button,
  input[type="number"]::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }
  input[type="number"] {
    -moz-appearance: textfield;
  }
</style>

<%= turbo_frame_tag "line_item_material_#{line_item_material.id}" do %>
  <!-- Wrapper div with Stimulus controller -->
  <div data-controller="line-item-material-form"
       data-tender-id="<%= line_item_material.tender_line_item.tender_id %>">
    <%= form_with(model: line_item_material, method: :patch, class: "contents", data: {
      controller: "dirty-form",
      action: "input->dirty-form#change change->dirty-form#change turbo:submit-end->dirty-form#reset"
    }, local: { tender_line_item_id: line_item_material.tender_line_item_id }) do |form| %>
      <%= hidden_field_tag :tender_line_item_id, line_item_material.tender_line_item_id %>
      <!-- Material Row - Ultra Compact -->
      <div class="bg-white border-b p-1 hover:bg-gray-50">
        <div class="grid grid-cols-12 gap-1 items-center">
          
          <!-- Material Supply Dropdown -->
          <div class="col-span-3">
            <%= form.collection_select :material_supply_id, MaterialSupply.all, :id, :name,
                { prompt: "Select" },
                class: "select select-bordered select-xs w-full text-xs",
                data: { action: "change->line-item-material-form#autoFill" } %>
          </div>

          <!-- Waste % Field -->
          <div class="col-span-2">
            <%= form.number_field :waste_percentage,
                placeholder: "Waste %",
                step: 0.01,
                class: "input input-bordered input-xs w-full text-right text-xs",
                data: { "line-item-material-form-target": "wastePercentageInput" } %>
          </div>

          <!-- Rate Field -->
          <div class="col-span-2">
            <%= form.number_field :rate,
                placeholder: "Rate",
                step: 0.01,
                class: "input input-bordered input-xs w-full text-right text-xs",
                data: { "line-item-material-form-target": "rateInput" } %>
          </div>

        <!-- Proportion Field -->
        <div class="col-span-2">
          <%= form.number_field :proportion_percentage,
              placeholder: "PROPORTION (%)",
              step: 0.01,
              min: 0,
              max: 100,
              class: "input input-bordered input-xs w-full text-right text-xs" %>
        </div>

        <!-- Line Total -->
        <div class="col-span-1 text-right font-semibold text-gray-900 text-xs" data-line-item-material-total>
          R<%= number_with_precision(line_item_material.line_total, precision: 2, delimiter: ",") %>
        </div>

        <!-- Action Buttons -->
        <div class="col-span-2 flex items-center justify-end gap-0.5">
          <span class="hidden w-2 h-2 rounded-full bg-red-500" data-dirty-form-target="indicator"></span>
          <%= form.button type: :submit, class: "btn btn-ghost btn-xs text-green-600 p-1" do %>
            <i class="fa-solid fa-check text-xs"></i>
          <% end %>
          <%= link_to line_item_material, data: { turbo_method: :delete, turbo_confirm: "Delete?" }, class: "btn btn-ghost btn-xs text-red-600 p-1" do %>
            <i class="fa-solid fa-trash text-xs"></i>
          <% end %>
        </div>
      </div>
    </div>
    <% end %>
  </div>
<% end %>
