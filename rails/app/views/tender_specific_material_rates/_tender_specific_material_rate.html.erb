<%= turbo_frame_tag dom_id(tender_specific_material_rate) do %>
  <div class="material-rate-row">
    <%= form_with model: [tender_specific_material_rate.tender, tender_specific_material_rate],
                  local: true,
                  data: {
                    controller: "dirty-form material-rate-lookup",
                    action: "input->dirty-form#change change->dirty-form#change turbo:submit-end->dirty-form#reset",
                    material_rate_lookup_url_value: lookup_tender_tender_specific_material_rates_path(tender_specific_material_rate.tender),
                    material_rate_lookup_monthly_rate_id_value: local_assigns[:monthly_rate_id]
                  },
                  class: "material-rate-form" do |f| %>
      <%= hidden_field_tag :monthly_rate_id, local_assigns[:monthly_rate_id] %>
      
      <div class="row-field material-name">
        <%= f.label :material_supply_id, "Material" %>
        <%= f.collection_select :material_supply_id, 
                                MaterialSupply.order(:position), 
                                :id, 
                                :name,
                                { prompt: "Select material..." },
                                class: "material-select",
                                data: { 
                                  material_rate_lookup_target: "materialSelect",
                                  action: "change->material-rate-lookup#updateRate"
                                } %>
      </div>

      <div class="row-field supplier-name">
        <%= f.label :supplier_id, "Supplier" %>
        <%= f.collection_select :supplier_id, 
                                Supplier.order(:name), 
                                :id, 
                                :name, 
                                { include_blank: true },
                                class: "supplier-select",
                                data: { 
                                  material_rate_lookup_target: "supplierSelect",
                                  action: "change->material-rate-lookup#updateRate"
                                } %>
      </div>
      
      <div class="row-field rate-value">
        <%= f.label :rate, "Rate" %>
        <%= f.number_field :rate, 
                           step: 0.01, 
                           min: 0,
                           placeholder: "0.00",
                           class: "rate-input",
                           data: { material_rate_lookup_target: "rateInput" } %>
      </div>
      
      <div class="row-field notes">
        <%= f.label :notes, "Notes" %>
        <%= f.text_field :notes, 
                         placeholder: "e.g., Negotiated Q4 2025",
                         class: "notes-input" %>
      </div>
      
      <div class="row-actions">
        <span class="dirty-indicator" 
              data-dirty-form-target="indicator" 
              style="display: none;">
          <i class="fa-solid fa-triangle-exclamation"></i> Unsaved
        </span>
        
        <%= f.submit "Save", 
                     class: "btn btn-sm btn-secondary",
                     data: { 
                       dirty_form_target: "submit",
                       disable_with: "Saving..."
                     } %>
        
        <%= link_to [tender_specific_material_rate.tender, tender_specific_material_rate],
                      data: { 
                        turbo_method: :delete,
                        turbo_confirm: "Remove this rate override?"
                      },
                      class: "btn btn-sm btn-danger" do %>
          <i class="fa-solid fa-trash"></i> Delete
        <% end %>
      </div>
    <% end %>
  </div>
<% end %>
